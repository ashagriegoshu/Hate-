<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Hate Speech Detector</title>
    <style>
        :root{
            --card-bg: #ffffff;
            --page-bg:#f4f6f8;
            --accent:#2b6cb0;
            --success-bg:#e6ffef;
            --success-border:#28a745;
            --danger-bg:#fff0f0;
            --danger-border:#e55353;
            --muted:#6b7280;
        }
        html,body{height:100%}
        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background: var(--page-bg);
            margin:0;
            color:#111827;
            display:flex;
            align-items:flex-start;
            justify-content:center;
            padding:40px 16px;
        }
        .box {
            width:100%;
            max-width:720px;
            background: var(--card-bg);
            padding:24px;
            border-radius:12px;
            box-shadow: 0 6px 24px rgba(15,23,42,0.08);
        }
        h2{margin:0 0 12px 0; font-size:20px}
        p.lead{margin:6px 0 18px 0; color:var(--muted); font-size:14px}

        form {display:block}
        textarea {
            width: 100%;
            min-height:140px;
            padding:12px;
            font-size:16px;
            border:1px solid #e6e8eb;
            border-radius:8px;
            resize:vertical;
            box-sizing:border-box;
            font-family:inherit;
            line-height:1.4;
        }
        .controls {
            margin-top:12px;
            display:flex;
            gap:8px;
            align-items:center;
            flex-wrap:wrap;
        }
        button {
            background: var(--accent);
            color: #fff;
            border: none;
            padding:10px 16px;
            border-radius:8px;
            font-size:15px;
            cursor:pointer;
        }
        button.secondary {
            background:#f3f4f6;
            color:#111827;
            border: 1px solid #e6e8eb;
        }
        .result {
            margin-top:18px;
            padding:14px;
            border-radius:8px;
            font-weight:600;
        }
        .result small { font-weight:400; display:block; margin-top:6px; color:var(--muted) }

        .result.success {
            background: var(--success-bg);
            border: 1px solid var(--success-border);
            color: #064e3b;
        }
        .result.danger {
            background: var(--danger-bg);
            border: 1px solid var(--danger-border);
            color: #7f1d1d;
        }

        .meta {
            margin-top:8px;
            color:var(--muted);
            font-size:13px;
        }

        @media (max-width:520px){
            .box{padding:16px}
            textarea{min-height:120px}
        }
    </style>
</head>
<body>
<div class="box" role="main" aria-labelledby="title">
    <h2 id="title">üõë Hate Speech Detection (Ge‚Äôez / Himtagna)</h2>
    <p class="lead">Paste text below and click "Analyze" to classify. Output shows a readable label in Amharic + English.</p>

    <form action="{{ url_for('predict') }}" method="post" autocomplete="off" novalidate>
        <label for="text" style="display:none">·åΩ·àë·çç</label>
        <textarea id="text"  name="text" placeholder="·åΩ·àë·çç ·ä†·àµ·åà·â£..." required aria-label="Input text to classify">{{ input_text|e }}</textarea>
        <!--textarea id="text" class = "translitInput" name="text" placeholder="·åΩ·àë·çç ·ä†·àµ·åà·â£..." required aria-label="Input text to classify">{{ input_text|e }}</textarea-->

        <div class="controls">
            <button type="submit">Analyze</button>
            <button type="button" class="secondary" onclick="document.getElementById('text').value='';">Clear</button>
            <div style="margin-left:auto" class="meta">Model: TF‚ÄëIDF + FastText + LinearSVC + SBi-LSTM</div>
        </div>
    </form>

    {% if prediction_text %}
        {% set is_non_hate = 'Non-Hate' in prediction_text or 'Non‚ÄëHate' in prediction_text %}
        <div class="result {{ 'success' if is_non_hate else 'danger' }}" role="status" aria-live="polite">
            {{ prediction_text|e }}
            <small>Input: {{ input_text|e }}</small>
        </div>
    {% endif %}
</div>
<script>
const specialConsonants = {
  'h': {
    normal: ['·àÄ', '·àÅ', '·àÇ', '·àÉ', '·àÑ', '·àÖ', '·àÜ'],
    //shift:  ['·àê', '·àë', '·àí', '·àì', '·àî', '·àï', '·àñ'],
   // caps:   ['·äÄ', '·äÅ', '·äÇ', '·äÉ', '·äÑ', '·äÖ', '·äÜ','·äã'],
    shiftCaps: ['·ä∏', '·äπ', '·ä∫', '·äª', '·äº', '·äΩ', '·äæ', '·ãÉ']
  },
  'l': {
    normal: ['·àà', '·àâ', '·àä', '·àã', '·àå', '·àç', '·àé', '·àè']
  },
  'm': {
    normal: ['·àò', '·àô', '·àö', '·àõ', '·àú', '·àù', '·àû', '·àü']
  },
  's': {
    normal: ['·à∞', '·à±', '·à≤', '·à≥', '·à¥', '·àµ', '·à∂', '·à∑'],   
    //shift:  ['·à†', '·à°', '·à¢', '·à£', '·à§', '·à•', '·à¶', '·àß'],
    caps:   ['·à∏', '·àπ', '·à∫', '·àª', '·àº', '·àΩ', '·àæ',  '·àø']
  },
  'r': {
    normal: ['·à®', '·à©', '·à™', '·à´', '·à¨', '·à≠', '·àÆ', '·àØ']
  },
  'q': {
    normal: ['·âÄ', '·âÅ', '·âÇ', '·âÉ', '·âÑ', '·âÖ', '·âÜ', '·âã', '·âà']
  },
  'b': {
    normal: ['·â†', '·â°', '·â¢', '·â£', '·â§', '·â•', '·â¶', '·âß']
  },
  'v': {
    normal: ['·â®', '·â©', '·â™', '·â´', '·â¨', '·â≠', '·âÆ', '·âØ']
  },
  't': {
    normal: ['·â∞', '·â±', '·â≤', '·â≥', '·â¥', '·âµ', '·â∂', '·â∑'],
    shift:  ['·å†', '·å°', '·å¢', '·å£', '·å§', '·å•', '·å¶', '·åß'],
    caps:   ['·å∏', '·åπ', '·å∫', '·åª', '·åº', '·åΩ', '·åæ', '·åø'  ],
    //shiftCaps: ['·çÄ', '·çÅ', '·çÇ', '·çÉ', '·çÑ', '·çÖ', '·çÜ']
  },
  'c': {
    normal: ['·â∏', '·âπ', '·â∫', '·âª', '·âº', '·âΩ', '·âæ', '·âø'],   
    shift:  ['·å®', '·å©', '·å™', '·å´', '·å¨', '·å≠', '·åÆ', '·åØ']
  },
  'n': {
    normal: ['·äê', '·äë', '·äí', '·äì', '·äî', '·äï', '·äñ', '·äó'],   
    shift:  ['·äò', '·äô', '·äö', '·äõ', '·äú', '·äù', '·äû', '·äü']
  },
  'x': {
    normal: ['·ä†', '·ä°', '·ä¢', '·ä£', '·ä§', '·ä•', '·ä¶', '·äß'],   
    //shift:  ['·ãê', '·ãë', '·ãí', '·ãì', '·ãî', '·ãï', '·ãñ']
  },
  'k': {
    normal: ['·ä®', '·ä©', '·ä™', '·ä´', '·ä¨', '·ä≠', '·äÆ', '·ä≥']
  },
  'w': {
    normal: ['·ãà', '·ãâ', '·ãä', '·ãã', '·ãå', '·ãç', '·ãé']
  },
  'z': {
    normal: ['·ãò', '·ãô', '·ãö', '·ãõ', '·ãú', '·ãù', '·ãû', '·ãü'],   
    shift:  ['·ã†', '·ã°', '·ã¢', '·ã£', '·ã§', '·ã•', '·ã¶',  '·ãß']
  },
  'y': {
    shift: ['·ã®', '·ã©', '·ã™', '·ã´', '·ã¨', '·ã≠', '·ãÆ']
  },
  'd': {
    normal: ['·ã∞', '·ã±', '·ã≤', '·ã≥', '·ã¥', '·ãµ', '·ã∂', '·ã∑']
  },
  'j': {
    normal: ['·åÄ', '·åÅ', '·åÇ', '·åÉ', '·åÑ', '·åÖ', '·åÜ', '·åá']
  },
  'g': {
    normal: ['·åà', '·åâ', '·åä', '·åã', '·åå', '·åç', '·åé', '·åì']
  },
  'p': {
    normal: ['·çê', '·çë', '·çí', '·çì', '·çî', '·çï', '·çñ', '·çó'],   
    shift:  ['·å∞', '·å±', '·å≤', '·å≥', '·å¥', '·åµ', '·å∂', '·å∑']
  },
  'f': {
    normal: ['·çà', '·çâ', '·çä', '·çã', '·çå', '·çç', '·çé', '·çè']
  }
};

const vowelIndex = {
  '': 0, // default if no vowel
  'u': 1,
  'i': 2,
  'a': 3,
  'y': 4,
  'e': 5,
  'o': 6,
  'O': 7,
  'W': 9,
  'Wu': 10,
  'Wi': 11,
  'Wy': 12,
  'Wo': 13,
  'WI': 14,
};

let capsLockOn = false;
document.addEventListener('keydown', (e) => {
  if (e.getModifierState) capsLockOn = e.getModifierState('CapsLock');
});

document.querySelectorAll('.translitInput').forEach(inputField => {
  let buffer = '';
  let lastInsertedIndex = -1;

  inputField.addEventListener('keydown', function (e) {
    const key = e.key.toLowerCase();
    const isVowel = vowelIndex.hasOwnProperty(key);

    if (specialConsonants[buffer] && isVowel) {
      e.preventDefault();
      const mod = e.shiftKey && capsLockOn ? 'shiftCaps' :
                  e.shiftKey ? 'shift' :
                  capsLockOn ? 'caps' : 'normal';

      const form = specialConsonants[buffer][mod][vowelIndex[key]];
      const value = inputField.value;

      inputField.value = value.slice(0, lastInsertedIndex) + form + value.slice(lastInsertedIndex + 1);
      buffer = '';
      lastInsertedIndex = -1;
      return;
    }

    if (specialConsonants[key]) {
      e.preventDefault();
      const mod = e.shiftKey && capsLockOn ? 'shiftCaps' :
                  e.shiftKey ? 'shift' :
                  capsLockOn ? 'caps' : 'normal';

      const defaultForm = specialConsonants[key][mod][0];
      const pos = inputField.selectionStart;
      const value = inputField.value;

      inputField.value = value.slice(0, pos) + defaultForm + value.slice(pos);
      inputField.setSelectionRange(pos + 1, pos + 1);

      buffer = key;
      lastInsertedIndex = pos;
      return;
    }

    if ([' ', 'Backspace', 'Enter'].includes(e.key)) {
      buffer = '';
      lastInsertedIndex = -1;
    }
  });
});
</script>
</body>
</html>